require 'rake'
require "sinatra/activerecord/rake"
require_relative 'lib/user_importer'
require ::File.expand_path('../config/environment', __FILE__)

Rake::Task["db:create"].clear
Rake::Task["db:drop"].clear

# NOTE: Assumes SQLite3 DB
desc "create the database"
task "db:create" do
  touch 'db/db.sqlite3'
end

desc "drop the database"
task "db:drop" do
  rm_f 'db/db.sqlite3'
end

desc "populate the database with sample user data"
task "db:populate" do
  UserImporter.new.import

  Product.create(
    name: 'iPhone 6', 
    description: 'New release from Apple.',
    price: 700,
    img_filepath: '/public/img/iphone6.jpg'
  )
  Product.create(
    name: 'Samsung Galaxy S5', 
    description: 'Samsung top smartphone',
    price: 680,
    img_filepath: '/public/img/galaxys5.jpg'
  )
  Product.create(
    name: 'Brazil Jersey', 
    description: 'Brazil national team jersey.',
    price: 70,
    img_filepath: '/public/img/brazil.jpg'
  )
  Product.create(
    name: 'Carver Skateboard', 
    description: 'Surf your Skateboard',
    price: 300,
    img_filepath: '/public/img/carver.jpg'
  )
  Product.create(
    name: 'Diesel Jeans', 
    description: 'Perfect fit.',
    price: 150,
    img_filepath: '/public/img/diesel.jpg'
  )
  Product.create(
    name: 'Vans shoes', 
    description: 'Confortable shoes',
    price: 55,
    img_filepath: '/public/img/vans.jpg'
  )

end

desc 'Retrieves the current schema version number'
task "db:version" do
  puts "Current version: #{ActiveRecord::Migrator.current_version}"
end

